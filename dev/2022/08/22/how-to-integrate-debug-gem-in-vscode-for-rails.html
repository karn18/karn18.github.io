<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" href="/images/favicon.png">

<title>ดีบัก Rails ด้วย VSCode + debug gem กันดีกว่า | KT</title>

<meta name="description" content="My personal blog. Interesting in Ruby, Rails and more." />
<!-- Begin Bridgetown SEO tag v5.0.0 -->
<title>ดีบัก Rails ด้วย VSCode + debug gem กันดีกว่า | KT</title>
<meta property="og:title" content="ดีบัก Rails ด้วย VSCode + debug gem กันดีกว่า" />
<meta name="author" content="Karn" />
<meta property="og:locale" content="th" />
<meta name="description" content="Debug Rails ด้วย VSCode + debug gem กันดีกว่า" />
<meta property="og:description" content="Debug Rails ด้วย VSCode + debug gem กันดีกว่า" />
<meta property="og:site_name" content="KT" />
<meta property="og:image" content="https://surfup.karn.work/covers/835ddb9c80/03c3ab3026.png" />
<meta property="og:image:height" content="630" />
<meta property="og:image:width" content="1200" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-08-22T18:54:00+07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://surfup.karn.work/covers/835ddb9c80/03c3ab3026.png" />
<meta property="twitter:title" content="ดีบัก Rails ด้วย VSCode + debug gem กันดีกว่า" />
<!-- End Bridgetown SEO tag -->

<link rel="stylesheet" href="/_bridgetown/static/index.NGPCTLGW.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<script type="module">
  import 'https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js';
</script>
<script defer data-domain="karn18.github.io" src="https://analytics.karn.work/js/plausible.js"></script>
<script src="/_bridgetown/static/index.QYWZG4PN.js" defer></script>


  </head>
  <body class="post ">
    <nav>
  <ul>
    <li><a href="/">Home</a></li>
    
    
  </ul>
</nav>

    <main>
      <main data-controller="lightbox">
  <h1>ดีบัก Rails ด้วย VSCode + debug gem กันดีกว่า</h1>

  <p>ปกติแล้ววิธีดีบักโค้ดที่ง่ายที่สุดก็คงหนีไม่พ้นการใส่ <code class="highlighter-rouge">puts</code> ทิ้งเอาไว้ตาม flow ของโปรแกรม เพื่อดูว่าแต่ละ step โปรแกรมทำงานถูกต้องตามที่เราคาดหวังไว้หรือไม่</p>

<p>ยกตัวอย่างเช่น ถ้าเราอยากตรวจสอบ <strong>params</strong> ที่เข้ามาว่ามี <strong>limit</strong> อยู่มั้ย และผลลัพท์จากการดึงข้อมูลได้ค่าเท่ากับ <strong>limit</strong> ที่กำหนดไว้หรือไม่ โค้ดก็คงจะออกมาประมาณนี้</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># books_controller</span>
<span class="k">def</span> <span class="nf">index</span>
  <span class="nb">puts</span> <span class="n">params</span>
  <span class="vi">@books</span> <span class="o">=</span> <span class="no">Book</span><span class="p">.</span><span class="nf">limit</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="nf">try</span><span class="p">(</span><span class="ss">:limit</span><span class="p">)</span> <span class="o">||</span> <span class="mi">10</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="vi">@books</span><span class="p">.</span><span class="nf">inspect</span>
<span class="k">end</span>
</code></pre></div></div>

<p>แน่นอนว่าสิ่งที่ยังคงหลงเหลือ หลังแก้ไขบักเรียบร้อยก็คือ เราต้องมาคอยตามลบ <code class="highlighter-rouge">puts</code> ที่เราใส่ไว้ในโค้ดออก เอาจริงๆ ก็ไม่ยุ่งยากอะไรเท่าไหร่หรอก 
แต่เพื่อยกระดับความเป็น<strong>โปรเฟสชันแนล</strong>ขึ้นอีกระดับ 555 ก็ลองมาใช้ <strong>debug</strong> กันดู</p>

<blockquote>
  <p>สำหรับ Rails สามารถเข้าไปศึกษาเพิ่มเติมได้ที่ <a href="https://guides.rubyonrails.org/debugging_rails_applications.html#debugging-with-the-debug-gem">Debugging with the debug gem</a></p>
</blockquote>

<p>ในบทความนี้เราจะมา setup ให้สามารถใช้งาน <strong>debug gem</strong> บน <a href="https://code.visualstudio.com/Docs/editor/debugging">debugger</a> ที่มาพร้อมกับ <strong>VSCode</strong> กัน</p>

<ul>
  <li>ติดตั้ง <a href="https://marketplace.visualstudio.com/items?itemName=KoichiSasada.vscode-rdbg">vscode-rdbg extension</a> กันก่อนเลย</li>
</ul>

<h2 id="รันทุกอย่างเสร็จสรรพบน-vscode">รันทุกอย่างเสร็จสรรพบน VSCode</h2>

<p>เพื่อความสะดวก โปรแกรมเมอร์บางคนก็ชอบที่จะทำงานอยู่บน <strong>VSCode</strong> เพียงอย่างเดียว โดยถ้าเราจะดีบัก <strong>Rails Application</strong> ด้วยก็จะต้องเพิ่มเติม config เข้าไปเล็กน้อย โดยให้เปิดโปรเจ็คที่ใช้งาน และเข้าไปยังเมนู <strong>Run -&gt; Open Configurations</strong> จากนั้นใส่ config ตามด้านล่าง</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Rails server"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"rdbg"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"request"</span><span class="p">:</span><span class="w"> </span><span class="s2">"launch"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cwd"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"command"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"script"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${workspaceFolder}/bin/rails"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"useBundler"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"args"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"s"</span><span class="p">],</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>รันโปรแกรมพร้อมดีบัก โดยเข้าไปที่เมนู <strong>Run -&gt; Start Debugging</strong> เพียงเท่านี้เราก็สามารถจะใส่ <strong>breakpoint, step over</strong> และอื่นๆ ได้ผ่าน <strong>Debug toolbar</strong></p>

<p><img src="/images/posts/2022/how-to-integrate-debug-gem-in-vscode-for-rails/debugging.png" alt="" />
<em>Debugging</em></p>

<h2 id="รันรีโมทดีบักผ่านคำสั่งนอก-vscode">รันรีโมทดีบักผ่านคำสั่งนอก VSCode</h2>

<p>สำหรับผม โดยส่วนตัวจะชอบรันคำสั่งต่างๆ ไว้บน <strong>iTerm</strong> ดังนั้นจะรันผ่านคำสั่งด้านล่างโดยตรง หรือนำคำสั่งไปใส่ใน <strong>Procfile</strong> ก็ได้</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rdbg <span class="nt">-O</span> <span class="nt">-n</span> <span class="nt">-c</span> <span class="nt">--</span> ./bin/rails s <span class="nt">-b</span> 0.0.0.0 <span class="nt">-p</span> 3000
</code></pre></div></div>

<p>จากนั้นก็จะใช้ <strong>VSCode</strong> ทำการเชื่อมต่อยัง remote debugger ที่เปิดเอาไว้ข้างต้น โดยเข้าไปที่ <strong>Run and Debug</strong> และเลือก config เป็น <strong>Attacch with rdbg</strong> จากนั้นก็กดปุ่ม <strong>Start</strong> ได้เลย</p>

<p><img src="/images/posts/2022/how-to-integrate-debug-gem-in-vscode-for-rails/attach_rdbg.png" alt="" />
<em>Attach rdbg</em></p>

<p>ทั้งนี้เราก็สามารถจะดีบักโปรแกรมได้สนุกมากยิ่งขึ้น</p>

</main>

    </main>
  </body>
</html>
