<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" href="/images/favicon.png">

<title>แสดงเวลาให้ตรงกับ timezone อย่างไร | KT</title>

<meta name="description" content="My personal blog. Interesting in Ruby, Rails and more." />
<!-- Begin Bridgetown SEO tag v5.0.0 -->
<title>แสดงเวลาให้ตรงกับ timezone อย่างไร | KT</title>
<meta property="og:title" content="แสดงเวลาให้ตรงกับ timezone อย่างไร" />
<meta name="author" content="Karn" />
<meta property="og:locale" content="th" />
<meta name="description" content="Display time with corrected timezone in Rails" />
<meta property="og:description" content="Display time with corrected timezone in Rails" />
<meta property="og:site_name" content="KT" />
<meta property="og:image" content="https://surfup.karn.work/covers/835ddb9c80/8b1ba70ee7.png" />
<meta property="og:image:height" content="630" />
<meta property="og:image:width" content="1200" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-10-31T10:20:00+07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://surfup.karn.work/covers/835ddb9c80/8b1ba70ee7.png" />
<meta property="twitter:title" content="แสดงเวลาให้ตรงกับ timezone อย่างไร" />
<!-- End Bridgetown SEO tag -->

<link rel="stylesheet" href="/_bridgetown/static/index.2G7YMXGO.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<script type="module">
  import 'https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js';
</script>
<script defer data-domain="karn18.github.io" src="https://analytics.karn.work/js/plausible.js"></script>
<script src="/_bridgetown/static/index.QYWZG4PN.js" defer></script>


  </head>
  <body class="post ">
    <nav>
  <ul>
    <li><a href="/">Home</a></li>
    
    
  </ul>
</nav>

    <main>
      <main data-controller="lightbox">
  <h1>แสดงเวลาให้ตรงกับ timezone อย่างไร</h1>

  <p><code class="highlighter-rouge">Time.now</code> เมื่อถูกเรียกใช้งานจะดึงเวลาปัจจุบันจากเครื่องที่มาอ้างอิง ซึ่งถ้าเป็นสถานะการที่ควบคุมได้อย่างเช่น เครื่องคอมพิวเตอร์ของเรา หรือ VM ที่เราเข้าไปจัดการ timezone ได้ ส่วนใหญ่ก็จะไม่เจอปัญหาที่ว่า <strong>เวลาที่ใช้แสดงบนหน้าเว็บกับเวลาที่บันทึกจริงไม่ตรงกัน</strong></p>

<blockquote>
  <p>เราบันทึกข้อมูลเวลา 10 โมงเช้าประเทศไทย แต่เมื่อบันทึกข้อมูลเสร็จ เข้าไปดูในหน้ารายละเอียด กลับพบว่าเวลาที่บันทึกกลายเป็น 3 โมงเช้าซะงั้น</p>
</blockquote>

<p>ทั้งนี้ก็เนื่องมาจาก timezone ที่ในเครื่องใช้ UTC เท่ากับ +0 อยู่แทนที่จะเป็น +7 พอเป็นแบบนี้ส่งผลให้เวลาที่บันทึกอยู่ในฐานข้อมูลก็ผิดไปด้วย ดังนั้นการนำข้อมูลกลับออกมาแสดงจะต้องทำการแปลงเวลาใหม่ให้อยู่ใน timezone ที่ถูกต้องก่อนผ่าน <code class="highlighter-rouge">in_time_zone</code></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">current_date_format_in_timezone</span><span class="p">(</span><span class="n">datetime</span><span class="p">,</span> <span class="n">timzone</span> <span class="o">=</span> <span class="s2">"Asia/Bangkok"</span><span class="p">)</span>
  <span class="n">datetime</span><span class="p">.</span><span class="nf">in_time_zone</span><span class="p">(</span><span class="n">timzone</span><span class="p">).</span><span class="nf">strftime</span><span class="p">(</span><span class="s2">"%d/%m/%Y %H:%M:%S"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>โดย <strong>Rails</strong> จะกำหนดค่ามาตรฐานของ <code class="highlighter-rouge">time_zone</code> ที่จะใช้งานได้ใน <code class="highlighter-rouge">config/application.rb</code></p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># config/application.rb</span>
<span class="o">...</span>
<span class="n">config</span><span class="p">.</span><span class="nf">time_zone</span> <span class="o">=</span> <span class="s2">"Asia/Bangkok"</span>
</code></pre></div></div>

<p>และสามารถดึงค่า timezone ที่กำหนดผ่าน <code class="highlighter-rouge">Time.zone (ActiveSupport::TimeZone)</code> ได้เลย</p>

</main>

    </main>
  </body>
</html>
