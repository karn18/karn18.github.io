<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" href="/images/favicon.png">

<title>เพิ่มการเชื่อมโยงลิงค์ในหน้าเว็บด้วย Stimulus | KT</title>

<meta name="description" content="Write an awesome description for your new site here. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />

<link rel="stylesheet" href="/karn.work/_bridgetown/static/index.KTVN5CND.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<script type="module">
  import 'https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js';
</script>
<script src="/karn.work/_bridgetown/static/index.OWF3DFHJ.js" defer></script>


  </head>
  <body class="post ">
    <nav>
  <ul>
    <li><a href="/karn.work/">Home</a></li>
    
    
  </ul>
</nav>

    <main>
      <main data-controller="lightbox">
  <h1>เพิ่มการเชื่อมโยงลิงค์ในหน้าเว็บด้วย Stimulus</h1>

  <p>ลิงค์ Anchor เป็นอีกวิธีการหนึ่งที่จะทำให้เราสามารเข้าถึงเนื้อหาภายในหน้าเว็บได้ง่ายขึ้น ผ่านการปักสมอหรือหมุดไม่ว่าจะด้วยชื่อหรือไอดีไว้บน Heading ต่างๆ สำหรับบล๊อกนี้สร้างขึ้นด้วย <strong>Jekyll</strong> ซึ่งเนื้อหาจะถูกสร้างขึ้นจาก Markdown เป็น HTML แต่ Markdown เองก็ไม่ได้ Syntax ที่รองรับให้มีลิงค์ Anchor ด้วย ดังนั้นเราจะมาเพิ่มเติม Anchor ให้เว็บของเราด้วย <strong>Stimulus</strong> กัน</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// javascripts/controllers/anchor_controller.js</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Controller</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@hotwired/stimulus</span><span class="dl">"</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">headings</span> <span class="o">=</span> <span class="p">[</span> <span class="dl">"</span><span class="s2">h1</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">h2</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">h3</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">h4</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">h5</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">h6</span><span class="dl">"</span> <span class="p">]</span>
  <span class="kd">static</span> <span class="nx">values</span> <span class="o">=</span> <span class="p">{</span> <span class="na">idEnabled</span><span class="p">:</span> <span class="nb">Boolean</span> <span class="p">}</span>
  <span class="kd">static</span> <span class="nx">classes</span> <span class="o">=</span> <span class="p">[</span> <span class="dl">"</span><span class="s2">anchorLink</span><span class="dl">"</span> <span class="p">]</span>

  <span class="nx">connect</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">headings</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kd">constructor</span><span class="p">.</span><span class="nx">headings</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2">,</span><span class="dl">"</span><span class="p">))</span>
    <span class="kd">const</span> <span class="nx">anchorLinkClass</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hasAnchorLinkClass</span> <span class="p">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">anchorLinkClass</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">anchor-link</span><span class="dl">"</span>
    <span class="nx">headings</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">heading</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">slugify</span><span class="p">(</span><span class="nx">heading</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">idEnabledValue</span><span class="p">)</span> <span class="p">{</span> <span class="nx">heading</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span> <span class="p">}</span>
      <span class="nx">heading</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">`&lt;a href="#</span><span class="p">${</span><span class="nx">id</span><span class="p">}</span><span class="s2">" class="</span><span class="p">${</span><span class="nx">anchorLinkClass</span><span class="p">}</span><span class="s2">"&gt;</span><span class="p">${</span><span class="nx">heading</span><span class="p">.</span><span class="nx">innerText</span><span class="p">}</span><span class="s2">&lt;\/a&gt;`</span>
    <span class="p">})</span>

    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">turbo:click</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="dl">"</span><span class="s2">#</span><span class="dl">"</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">slugify</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^</span><span class="se">\s</span><span class="sr">+|</span><span class="se">\s</span><span class="sr">+$/g</span><span class="p">,</span> <span class="dl">''</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\s</span><span class="sr">+/g</span><span class="p">,</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/-+/g</span><span class="p">,</span> <span class="dl">'</span><span class="s1">-</span><span class="dl">'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>โค้ดข้างต้นเราจะทำการค้นหา Heading ที่เราต้องการจะใส่ลิงค์ Anchor เข้าไปโดยไล่ตั้งแต่ <strong>&lt;h1/&gt;</strong> ไปถึง <strong>&lt;h6/&gt;</strong> จากนั้นเราก็ยัด <strong>&lt;a/&gt;</strong> ที่มี href เชื่อมโยงกับ Heading นั้นๆ ไว้ภายใน</p>

<p>ในกรณีที่มีการใช้งานร่วมกัน <strong>Turbo</strong> เราจะต้องเพิ่มการรับฟังเหตุการณ์จาก <code class="highlighter-rouge">turbo:click</code> ไว้ด้วย โดยถ้า URL ที่คลิกมีเครื่องหมาย <code class="highlighter-rouge">#</code> เราจะต้องหยุดไม่ให้โค้ดทำงานต่อ เพราะจะทำให้ลิงค์ที่กดไม่เชื่อมโยงไปยัง Anchor ที่เรากำหนดไว้</p>

<p>เอาจริงตอนแรกได้ทดลองใช้ <code class="highlighter-rouge">anchor-js</code> แล้วรู้สึกว่าใช้งานง่ายมาก แต่ตอนปรับแก้ CSS แล้วมันยากนิดหน่อยก็เลยเลือกที่จะเขียนโค้ดที่จัดการทุกอย่างเอง สำหรับตัวอย่างการใช้งานโค้ดก็ดูได้ในเว็บของเราได้ เพราะได้ทำการ deploy เอาไว้แล้ว</p>

<h2 id="references">References</h2>
<ul>
  <li><a href="https://github.com/bryanbraun/anchorjs">anchor-js</a></li>
</ul>

</main>

    </main>
  </body>
</html>
