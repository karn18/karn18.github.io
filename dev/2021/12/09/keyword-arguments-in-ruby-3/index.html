<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" href="/images/favicon.png">

<title>Keyword Argument ใน Ruby 3 | KT</title>

<meta name="description" content="Write an awesome description for your new site here. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />

<link rel="stylesheet" href="/_bridgetown/static/index.NXSPJ6K7.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<script type="module">
  import 'https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js';
</script>
<script defer data-domain="karn18.github.io" src="https://analytics.karn.work/js/plausible.js"></script>
<script src="/_bridgetown/static/index.TU2OTUPV.js" defer></script>


  </head>
  <body class="post ">
    <nav>
  <ul>
    <li><a href="/">Home</a></li>
    
    
  </ul>
</nav>

    <main>
      <main data-controller="lightbox">
  <h1>Keyword Argument ใน Ruby 3</h1>

  <p>ไม่ว่าจะใช้ภาษาอะไรในการพัฒนาโปรแกรม เมื่อมีอัพเดตเวอร์ชันที่เป็นเมเจอร์เกิดขึ้นใหม่ จะมีการเปลี่ยนแปลงที่ส่งผลกระทบต่อโค้ดเก่าไม่มากก็น้อย ซึ่งในส่วนของ Ruby เวอร์ชัน 3 ก็เช่นกัน โดยในบทความนี้จะกล่าวถึงผลกระทบที่เกิดขึ้นกับการใช้งาน keyword argument เพราะผมเพิ่งจะโดนเข้าไปเนื่องจากการไมเกรตโปรเจ็คจาก Ruby เวอร์ชัน 2 ไปเป็นเวอร์ชัน 3 นั้นเอง</p>

<p>ก่อนอื่นต้องทำความเข้าใจกันก่อนว่าใน Ruby 2 เราจะใช้ keyword argument กันอย่างไร</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Ruby 2.7</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"default"</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="nb">name</span>
<span class="k">end</span>
<span class="c1"># foo -&gt; "default"</span>
<span class="c1"># foo("karn") -&gt; "karn"</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="nb">puts</span> <span class="n">kwargs</span>
<span class="k">end</span>
<span class="c1"># foo -&gt; {}</span>
<span class="c1"># foo(name: "karn", value: 3) -&gt; {:name=&gt;"karn", :value=&gt;3}</span>
<span class="c1"># foo({ name: "karn", value: 3 }) -&gt; {:name=&gt;"karn", :value=&gt;3}</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">kwargs</span>
<span class="k">end</span>
<span class="c1"># foo -&gt; {}</span>
<span class="c1"># foo(name: "karn", value: 3) -&gt; {:name=&gt;"karn", :value=&gt;3}</span>
</code></pre></div></div>

<p>โดยรูปแบบของการใช้งาน keyword argument จะเป็นดังตัวอย่างโค้ดข้างต้นคือ</p>
<ol>
  <li>นิยามโดยใช้ keyword แบบตรงไปตรงมา ซึ่งเราสามารถกำหนดเป็น required หรือ optional ก็ได้</li>
  <li>นิยามผ่าน hash โดยใน Ruby 2 จะมอง Hash ที่ถูกส่งมาเป็น keyword argument</li>
  <li>นิยามโดยใช้ ** (double splat)</li>
</ol>

<p>ใน Ruby 3 รูปแบบของ keyword argument จะถูกแยกออกจาก postional argument จึงทำให้เหลือ 2 รูปแบบในการเรียกใช้งาน keyword argument ซึ่งก็คือ <code class="highlighter-rouge">def foo(name: "default"); end</code> และ <code class="highlighter-rouge">def foo(**kwargs); end</code> ส่วนการเรียกใช้งาน <code class="highlighter-rouge">def foo(kwargs = {})</code> ซึ่งรับค่าเป็น Hash จะไม่มองว่าเป็น keyword argument อีกต่อไป และโค้ดที่เราใช้อยู่ใน Ruby 2 ก็ยังคงทำงานได้ปกติใน Ruby 3</p>

<p><strong>แต่</strong>โค้ดที่จะพังทันทีก็คือโค้ดที่มีการเรียกใช้งาน <code class="highlighter-rouge">def foo(**kwargs); end</code> พร้อมส่งผ่านพารามิเตอร์ที่เป็น Hash เข้าไป โดยจะฟ้องข้อผิดพลาดที่ชื่อ <code class="highlighter-rouge">ArgumentError</code> ขึ้นมา</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Ruby 3</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">kwargs</span>
<span class="k">end</span>

<span class="n">foo</span><span class="p">({</span> <span class="ss">name: </span><span class="s2">"karn"</span><span class="p">,</span> <span class="ss">value: </span><span class="mi">3</span> <span class="p">})</span> <span class="o">-&gt;</span> <span class="n">foo</span><span class="err">'</span><span class="p">:</span> <span class="n">wrong</span> <span class="n">number</span> <span class="n">of</span> <span class="n">arguments</span> <span class="p">(</span><span class="n">given</span> <span class="mi">2</span><span class="p">,</span> <span class="n">expected</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="no">ArgumentError</span><span class="p">)</span>
</code></pre></div></div>

<p>แน่นอนว่าโปรเจ็คของทีมมีการนิยามเมธอดที่เป็น keyword argument ดังโค้ดข้างต้น ดังนั้นเมื่อมีการอัพเดตไปใช้ Ruby เวอร์ชัน 3 เราต้องรีบมาทางแก้ไขปัญหาดังกล่าว ซึ่งสามารถทำได้ 2 วิธีในการเรียกใช้เมธอดคือ</p>

<ol>
  <li>
    <p>ใส่ <code class="highlighter-rouge">**</code> (double splat) ไว้ด้านหน้า <code class="highlighter-rouge">{ }</code></p>

    <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">foo</span><span class="p">(</span><span class="o">**</span><span class="p">{</span> <span class="ss">name: </span><span class="s2">"karn"</span><span class="p">,</span> <span class="ss">value: </span><span class="mi">3</span> <span class="p">})</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>ถอดเอา <code class="highlighter-rouge">{ }</code> ออก</p>
  </li>
</ol>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">foo</span><span class="p">(</span><span class="ss">name: </span><span class="s2">"karn"</span><span class="p">,</span> <span class="ss">value: </span><span class="mi">3</span><span class="p">)</span>
</code></pre></div></div>

<p>เรียบร้อยเพียงเท่านี้เราก็แก้ปัญหาเรื่อง keyword argument ใน Ruby 3 ได้</p>

<h2 id="references">References</h2>
<ul>
  <li><a href="https://www.ruby-lang.org/en/news/2019/12/12/separation-of-positional-and-keyword-arguments-in-ruby-3-0/">Separation of positional and keyword arguments in ruby 3.0</a></li>
</ul>

</main>

    </main>
  </body>
</html>
