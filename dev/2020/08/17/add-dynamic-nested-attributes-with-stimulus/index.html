<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" href="/images/favicon.png">

<title>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏±‡∏Å‡∏±‡∏ö nested attributes ‡πÅ‡∏ö‡∏ö dynamic ‡∏î‡πâ‡∏ß‡∏¢ stimulus | KT</title>

<meta name="description" content="My personal blog. Interesting in Ruby, Rails and more." />
<!-- Begin Bridgetown SEO tag v5.0.0 -->
<title>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏±‡∏Å‡∏±‡∏ö nested attributes ‡πÅ‡∏ö‡∏ö dynamic ‡∏î‡πâ‡∏ß‡∏¢ stimulus | KT</title>
<meta property="og:title" content="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏±‡∏Å‡∏±‡∏ö nested attributes ‡πÅ‡∏ö‡∏ö dynamic ‡∏î‡πâ‡∏ß‡∏¢ stimulus" />
<meta name="author" content="Karn" />
<meta property="og:locale" content="th" />
<meta name="description" content="My personal blog. Interesting in Ruby, Rails and more." />
<meta property="og:description" content="My personal blog. Interesting in Ruby, Rails and more." />
<link rel="canonical" href="https://karn18.github.io/dev/2020/08/17/add-dynamic-nested-attributes-with-stimulus/" />
<meta property="og:url" content="https://karn18.github.io/dev/2020/08/17/add-dynamic-nested-attributes-with-stimulus/" />
<meta property="og:site_name" content="KT" />
<meta property="og:image" content="https://karn18.github.io/images/posts/2020/add-dynamic-nested-attributes-with-stimulus/cover.png" />
<meta property="og:image:height" content="630" />
<meta property="og:image:width" content="1200" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-08-17T09:46:00+07:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://karn18.github.io/images/posts/2020/add-dynamic-nested-attributes-with-stimulus/cover.png" />
<meta property="twitter:title" content="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏±‡∏Å‡∏±‡∏ö nested attributes ‡πÅ‡∏ö‡∏ö dynamic ‡∏î‡πâ‡∏ß‡∏¢ stimulus" />
<!-- End Bridgetown SEO tag -->

<link rel="stylesheet" href="/_bridgetown/static/index.OJNAJA5Q.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<script type="module">
  import 'https://cdn.jsdelivr.net/gh/mcstudios/glightbox/dist/js/glightbox.min.js';
</script>
<script defer data-domain="karn18.github.io" src="https://analytics.karn.work/js/plausible.js"></script>
<script src="/_bridgetown/static/index.QYWZG4PN.js" defer></script>


  </head>
  <body class="post ">
    <nav>
  <ul>
    <li><a href="/">Home</a></li>
    
    
  </ul>
</nav>

    <main>
      <main data-controller="lightbox">
  <h1>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡∏±‡∏Å‡∏±‡∏ö nested attributes ‡πÅ‡∏ö‡∏ö dynamic ‡∏î‡πâ‡∏ß‡∏¢ stimulus</h1>

  <p>üí° ‡πÑ‡∏î‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏Å‡πâ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô <strong>Nested Attributes</strong> ‡∏Å‡πá‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ß‡πà‡∏≤‡∏°‡∏±‡∏ô‡∏°‡∏µ‡∏ö‡∏±‡∏Ñ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö <strong>Nested Attributes</strong> ‡∏ã‡∏∂‡πà‡∏á‡∏û‡∏≠‡∏°‡∏≤‡∏ô‡∏±‡πà‡∏á‡∏Ñ‡∏¥‡∏î‡πÜ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏π‡∏ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏î‡πâ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Å‡∏±‡∏ö <strong>Stimulus</strong> ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡∏Å‡πá‡∏Ñ‡∏á‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô<!--more--></p>

<p>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏à‡∏ó‡∏¢‡πå‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡πÇ‡∏î‡∏¢‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏•‡πà‡∏°‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏õ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÜ ‡∏Å‡∏±‡∏ô</p>

<ul>
  <li>
    <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏°‡πÄ‡∏î‡∏• <strong>Book</strong> ‡πÅ‡∏•‡∏∞ <strong>Author</strong></p>
  </li>
  <li>
    <p>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á <strong>Book</strong> ‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö <strong>Nested Attributes</strong> ‡∏Ç‡∏≠‡∏á <strong>Author</strong></p>
  </li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Book</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:authors</span>

  <span class="n">accepts_nested_attributes_for</span> <span class="ss">:authors</span><span class="p">,</span> <span class="ss">reject_if: :all_blank</span><span class="p">,</span> <span class="ss">allow_destroy: </span><span class="kp">true</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>‡πÇ‡∏°‡πÄ‡∏î‡∏• <strong>Author</strong> ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡πá‡∏ï‡πà‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô attribute ‡∏ó‡∏µ‡πà‡∏ä‡∏∑‡πà‡∏≠ _destroy</p>
</blockquote>

<ul>
  <li>‡∏™‡∏£‡πâ‡∏≤‡∏á <strong>template</strong> ‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏° <strong>Author</strong> ‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡∏á <strong>Book</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ <strong>Stimulus Controller</strong> ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ</li>
</ul>

<h2 id="appviewsbooks_formhtmlerb">app/views/books/_form.html.erb</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nt">&lt;h2&gt;</span>Authors:<span class="nt">&lt;/h2&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"authors"</span> <span class="na">data-controller=</span><span class="s">"nested"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;template</span> <span class="na">data-target=</span><span class="s">"nested.template"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'authors/form'</span><span class="p">,</span> <span class="ss">model: </span><span class="no">Author</span><span class="p">.</span><span class="nf">new</span><span class="p">,</span> <span class="ss">form: </span><span class="n">form</span><span class="p">,</span> <span class="ss">child_index: </span><span class="s1">'NEXT_ID'</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/template&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">data-target=</span><span class="s">"nested.parent"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'authors/form'</span><span class="p">,</span> <span class="ss">model: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">form: </span><span class="n">form</span><span class="p">,</span> <span class="ss">child_index: </span><span class="kp">nil</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Add Author"</span><span class="p">,</span> <span class="s2">"#"</span><span class="p">,</span> <span class="ss">data: </span><span class="p">{</span> <span class="ss">action: </span><span class="s2">"nested#add_associate"</span> <span class="p">},</span> <span class="ss">class: </span><span class="s2">"btn"</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>‡∏à‡∏∞‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ <template></template> ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏ö‡∏ö dynamic</p>
</blockquote>

<ul>
  <li>‡∏™‡∏£‡πâ‡∏≤‡∏á <strong>Stimulus Controller</strong> ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏Ç‡∏≠‡∏á <strong>Author</strong> ‡πÅ‡∏ö‡∏ö dynamic</li>
</ul>

<h2 id="appjavascriptscontrollersnested_controllerjs">app/javascripts/controllers/nested_controller.js</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Controller</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">stimulus</span><span class="dl">"</span>

<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="kd">extends</span> <span class="nx">Controller</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="nx">targets</span> <span class="o">=</span> <span class="p">[</span> <span class="dl">"</span><span class="s2">template</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">parent</span><span class="dl">"</span> <span class="p">]</span>

  <span class="nx">add_associate</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>

    <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">templateTarget</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/NEXT_ID/g</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">())</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parentTarget</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="dl">'</span><span class="s1">beforeend</span><span class="dl">'</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå <code class="highlighter-rouge">add_associate</code> ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° <code class="highlighter-rouge">NEXT_ID</code> ‡∏î‡πâ‡∏ß‡∏¢ timestamp ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏ß‡πâ</p>
</blockquote>

<ul>
  <li>‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á <strong>Author</strong></li>
</ul>

<h2 id="appviewsauthors_formhtmlerb">app/views/authors/_form.html.erb</h2>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">fields_for</span> <span class="ss">:authors</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="ss">child_index: </span><span class="n">child_index</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"-form"</span> <span class="k">do</span> <span class="o">|</span><span class="n">author_fields</span><span class="o">|</span><span class="cp">%&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">author_fields</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:full_name</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"form-label col-2"</span> <span class="cp">%&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">author_fields</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:full_name</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"form-input col-7"</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">"form-checkbox col-2 mx-2"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">author_fields</span><span class="p">.</span><span class="nf">check_box</span> <span class="ss">:_destroy</span><span class="p">,</span> <span class="ss">class: </span><span class="s2">"form-checkbox"</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;i</span> <span class="na">class=</span><span class="s">"form-icon"</span><span class="nt">&gt;&lt;/i&gt;</span> Delete
      <span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre></div></div>

<ul>
  <li>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ó‡πå‡∏Å‡∏±‡∏ô‡∏î‡∏π</li>
</ul>

<p><img src="/images/posts/2020/add-dynamic-nested-attributes-with-stimulus/example.gif" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á" /></p>

<h2 id="references">References</h2>
<ul>
  <li><a href="https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html">https://api.rubyonrails.org/classes/ActiveRecord/NestedAttributes/ClassMethods.html</a></li>
  <li><a href="https://www.driftingruby.com/episodes/nested-forms-from-scratch-with-stimulusjs">https://www.driftingruby.com/episodes/nested-forms-from-scratch-with-stimulusjs</a></li>
</ul>

</main>

    </main>
  </body>
</html>
